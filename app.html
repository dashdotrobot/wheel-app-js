<!doctype html>
<html lang="en">
<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

  <title>Hello, world!</title>
</head>
<body>

<div class="container">
  <h3>Bicycle wheel app</h3>
  <div class="row">
    <div class="col-3">

      <!-- Toolbar Navigation Tabs -->
      <ul class="nav nav-tabs" id="toolsTab" role="tablist">
        <li class="nav-item">
          <a class="nav-link active" id="tabRim" data-toggle="tab" href="#panelRim" role="tab" aria-controls="panelRim" aria-selected="true">Rim</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" id="tabHub" data-toggle="tab" href="#panelHub" role="tab" aria-controls="panelHub" aria-selected="false">Hub</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" id="tabSpokes" data-toggle="tab" href="#panelSpokes" role="tab" aria-controls="panelSpokes" aria-selected="false">Spokes</a>
        </li>
      </ul>

      <div class="tab-content" id="toolsContents">

        <!-- RIM TOOLBAR -->
        <div class="tab-pane fade show active" id="panelRim" role="tabpanel" aria-labelledby="tabRim">

          <form id="formRim">

            <div class="form-group">
              <select class="form-control form-control-sm" name="rimSize" id="rimSize">
                <option>700C/29er/28" (622)</option>
                <option>27" frac (630)</option>
                <option>650B (584)</option>
              </select>
            </div>

            <div class="form-group">
              <div class="btn-group btn-group-toggle btn-group-sm" data-toggle="buttons" id="rimMatl">
                <label class="btn btn-secondary active">
                  <input type="radio" name="rimMatlAlloy" id="rimMatlAlloy" autocomplete="off" checked>Alloy
                </label>
                <label class="btn btn-secondary">
                  <input type="radio" name="rimMatlSteel" id="rimMatlSteel" autocomplete="off">Steel
                </label>
                <label class="btn btn-secondary">
                  <input type="radio" name="rimMatlCarbon" id="rimMatlCarbon" autocomplete="off">Carbon
                </label>
              </div>
            </div>

            <div class="form-group">
              <label for="rimMass">Mass [grams]:&nbsp;</label><span><strong>540</strong></span>
              <input type="range" class="form-control-range custom-range update-range" name="rimMass" id="rimMass" min="10" step="10" max="2000" value="540">

              <label for="rimRadStiff">Radial stiffness [N-m^2]:&nbsp;</label><span><strong>110</strong></span>
              <input type="range" class="form-control-range custom-range update-range" name="rimRadStiff" id="rimRadStiff" min="10" max="1000" step="10" value="110">

              <label for="rimLatStiff">Lateral stiffness [N-m^2]:&nbsp;</label><span><strong>220</strong></span>
              <input type="range" class="form-control-range custom-range update-range" name="rimLatStiff" id="rimLatStiff" min="10" max="500" value="220">

              <label for="rimTorStiff">Torsional stiffness [N-m<sup>2</sup>]:&nbsp;</label><span><strong>25</strong></span>
              <input type="range" class="form-control-range custom-range update-range" name="rimTorStiff" id="rimTorStiff" min="5" max="200" step="5" value="25">
            </div>

          </form>

        </div>

        <!-- HUB TOOLBAR -->
        <div class="tab-pane fade" id="panelHub" role="tabpanel" aria-labelledby="tabHub">

          <form id="formHub">

            <div class="form-group">
              <div class="btn-group btn-group-toggle btn-group-sm" data-toggle="buttons" id="hubSymm">
                <label class="btn btn-secondary active">
                  <input type="radio" id="rimMatlAlloy" autocomplete="off" checked>Symmetric
                </label>
                <label class="btn btn-secondary">
                  <input type="radio" id="rimMatlSteel" autocomplete="off">Asymmetric
                </label>
              </div>
            </div>

            <label for="hubWidthLeft">Rim-to-flange distance [mm]</label>

            <div class="form-row">
              <div class="col-sm-6">
                Left:&nbsp;<span id="hubWidthLeft_label"><strong>25</strong></span>
              </div>
              <div class="col-sm-6">
                Right:&nbsp;<span id="hubWidthRight_label"><strong>25</strong></span>
              </div>
            </div>

            <div class="form-group form-row">
              <div class="col-sm-6">
                <input type="range" class="form-control-range custom-range" name="hubWidthLeft" id="hubWidthLeft" min="-50" max="0" step="1" value="-25">
              </div>
              <div class="col-sm-6">
                <input type="range" class="form-control-range custom-range" name="hubWidthRight" id="hubWidthRight" min="0" max="50" step="1" value="25">
              </div>
            </div>

            <div class="form-group">
              <label for="hubDiameter">Flange diameter [mm]:&nbsp;</label><span><strong>50</strong></span>
              <input type="range" class="form-control-range custom-range update-range" name="hubDiameter" id="hubDiameter" min="0" max="100" value="50">
            </div>

          </form>

        </div>

        <!-- SPOKES TOOLBAR -->
        <div class="tab-pane fade" id="panelSpokes" role="tabpanel" aria-labelledby="tabSpokes">

          <div class="form-group">
            <label for="spokesNum">Number of spokes</label>
            <input type="range" class="form-control-range custom-range" id="spokesNum">
          </div>

          <hr/><strong>Drive-side spokes</strong>

          <form>
            <div class="form-group">
              <select class="form-control form-control-sm" id="spkPatternDS">
                <option>Radial</option>
                <option>1-cross</option>
                <option>2-cross</option>
                <option>3-cross</option>
                <option>4-cross</option>
              </select>
            </div>

            <div class="form-group">
              <div class="btn-group btn-group-sm btn-group-toggle" data-toggle="buttons" id="spkMatlDS">
                <label class="btn btn-secondary active">
                  <input type="radio" name="spkMatlDS" id="spkMatlDSAlloy" autocomplete="off" checked>Alloy
                </label>
                <label class="btn btn-secondary">
                  <input type="radio" name="spkMatlDS" id="spkMatlDSSteel" autocomplete="off">Steel
                </label>
                <label class="btn btn-secondary">
                  <input type="radio" name="spkMatlDS" id="spkMatlDSTi" autocomplete="off">Titanium
                </label>
              </div>
            </div>

            <div class="form-group">
              <label for="spokesDiamDS">Diameter [mm]:&nbsp;</label><span><strong>2</strong></span>
              <input type="range" class="form-control-range custom-range update-range" id="spokesDiamDS" min="0.1", max="3" step="0.1" value="2">

              <label for="spokesTensDS">Tension [kgf]:&nbsp;</label><span><strong>80</strong></span>
              <input type="range" class="form-control-range custom-range update-range" id="spokesTensDS" min="0" max="200" step="5" value="80">
            </div>
          </form>

          <hr/><strong>Non-drive-side spokes</strong>

          <div class="btn-group btn-group-sm btn-group-toggle" data-toggle="buttons">
            <label class="btn btn-secondary active">
              <input type="radio" name="options" id="spkNDSSame_yes" autocomplete="off" checked> Same as DS
            </label>
            <label class="btn btn-secondary">
              <input type="radio" name="options" id="spkNDSSame_no" autocomplete="off"> Different
            </label>
          </div>

          <div class="collapse" id="spkNDSPanel">

            <form>
              <div class="form-group">
                <select class="form-control form-control-sm" id="spkPatternNDS">
                  <option>Radial</option>
                  <option>1-cross</option>
                  <option>2-cross</option>
                  <option>3-cross</option>
                  <option>4-cross</option>
                </select>
              </div>

              <div class="form-group">
                <div class="btn-group btn-group-toggle btn-group-sm" data-toggle="buttons" id="spkMatlNDS">
                  <label class="btn btn-secondary active">
                    <input type="radio" name="spkMatlNDS" id="spkMatlNDSAlloy" autocomplete="off" checked>Alloy
                  </label>
                  <label class="btn btn-secondary">
                    <input type="radio" name="spkMatlNDS" id="spkMatlNDSSteel" autocomplete="off">Steel
                  </label>
                  <label class="btn btn-secondary">
                    <input type="radio" name="spkMatlNDS" id="spkMatlNDSTi" autocomplete="off">Titanium
                  </label>
                </div>
              </div>

              <div class="form-group">
                <label for="spokesDiamNDS">Diameter [mm]&nbsp;</label><span><strong>2</strong></span>
                <input type="range" class="form-control-range custom-range update-range" id="spokesDiamNDS" min="0.1", max="3" step="0.1" value="2">

                <label for="spokesTensNDS">Tension [kgf]:&nbsp;</label><span><strong>80</strong></span>
                <input type="range" class="form-control-range custom-range update-range" id="spokesTensNDS" min="0" max="200" step="5" value="80">
              </div>
            </form>

          </div>

        </div>

        <div><button type="button" id="btnPressMe" class="btn btn-success">Press me!</button></div>
      </div>

    </div>
    <div class="col-9">

      <!-- Results navigation tabs -->
      <ul class="nav nav-tabs" id="resultsTab" role="tablist">
        <li class="nav-item">
          <a class="nav-link active" id="plots-tab" data-toggle="tab" href="#plots" role="tab" aria-controls="plots" aria-selected="true">Plots</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" id="results-tab" data-toggle="tab" href="#results" role="tab" aria-controls="results" aria-selected="false">Results</a>
        </li>
      </ul>

      <div class="tab-content" id="resultsContents">

        <!-- Results: Plots -->
        <div class="tab-pane fade show active" id="plots" role="tabpanel" aria-labelledby="plots-tab">
          Plots
          <div id="tension-plot" style="height: 300px; border: 1px solid black;"></div>
        </div>

        <!-- Results: Summary -->
        <div class="tab-pane fade" id="results" role="tabpanel" aria-labelledby="results-tab">Summary results</div>
      </div>
    </div>

  </div>
</div>


<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.3.1.min.js" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

<script>


$('input.update-range').on('change mousemove', function() {
  $(this).prev().html('<strong>' + $(this).val() + '</strong>');
})

$('#hubWidthLeft').on('change mousemove', function() {
  $(('#hubWidthLeft_label')).html('<strong>' + (-parseInt($(this).val())).toString() + '</strong>')
})

$('#hubWidthRight').on('change mousemove', function() {
  $(('#hubWidthRight_label')).html('<strong>' + $(this).val() + '</strong>')
})

$('#spkNDSSame_yes').click(function() {
  $('#spkNDSPanel').collapse('hide')
})

$('#spkNDSSame_no').click(function() {
  $('#spkNDSPanel').collapse('show')
})



var default_wheel = {
  'wheel': {
      'hub': {
      'diameter': 0.05,
      'width_nds': 0.025,
      'width_ds': 0.025},
    'rim': {
      'radius': 0.3,
      'young_mod': 69e9,
      'shear_mod': 26e9,
      'density': 2700.,
      'section_type': 'general',
      'section_params': {
        'area': 100e-6,
        'I_rad': 100 / 69e9,
        'I_lat': 200 / 69e9,
        'J_tor': 25 / 26e9,
        'I_warp': 0.}},
    'spokes': {
      'num': 36,
      'num_cross': 3,
      'diameter': 1.8e-3,
      'young_mod': 210e9,
      'density': 8000.,
      'offset': 0.,
      'tension': 0.}},
}

function plot_tensions(data) {
  console.log(data)

  plot_canvas = document.getElementById('tension-plot');

  Plotly.newPlot(plot_canvas, [{
    x: data['tension']['spokes'],
    y: data['tension']['tension'],
    type: 'bar'
  }] );
}


$('#btnPressMe').on('click', function () {

  post_data = $.extend({}, default_wheel)

  post_data['tension'] = {
    'forces': [{'location': 3.1415, 'magnitude': [0., 1., 0., 0.]}]
  }

  // $.post({
  //   url: 'http://localhost:5000/calculate',
  //   data: JSON.stringify(post_data),
  //   dataType: 'json',
  //   contentType: 'application/json',
  //   success: function (result) {
  //     plot_tensions(result);
  //   },
  //   error: function (xhr, ajaxOptions, thrownError) {}
  // });

  console.log($('#formHub').serializeArray())

})


TESTER = document.getElementById('tension-plot');
Plotly.plot(TESTER,
[{
  x: [1, 3, 5],
  y: [2, 5, 3],
  type: 'bar'
}, {
  x: [0, 2, 4],
  y: [4, 4, 1],
  type: 'bar'
}] );


</script>

</body>
</html>